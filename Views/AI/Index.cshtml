@model FitnessSalonYonetim.Models.ApplicationUser

@{
    ViewData["Title"] = "AI Egzersiz & Diyet Asistanƒ±";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 class="mb-3"><i class="bi bi-robot"></i> Yapay Zeka Destekli Fitness Asistanƒ±</h1>
            <p class="lead text-muted">Ki≈üiye √∂zel egzersiz programlarƒ±, diyet √∂nerileri ve motivasyon g√∂rselleri olu≈üturun</p>
        </div>
    </div>

    <div class="row">
        <!-- Egzersiz & Diyet √ñnerisi B√∂l√ºm√º -->
        <div class="col-md-8">
            <div class="card shadow mb-4">
                <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="mb-0 text-white"><i class="bi bi-person-check"></i> Ki≈üisel Fitness Planƒ± Olu≈ütur</h5>
                </div>
                <div class="card-body">
                    <!-- Kullanƒ±cƒ± Profil √ñzeti -->
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="d-flex align-items-center bg-light p-3 rounded">
                                <div class="me-3">
                                    @if (!string.IsNullOrEmpty(Model?.ProfilResmi))
                                    {
                                        <img src="@Model.ProfilResmi" alt="Profil" class="rounded-circle" style="width: 80px; height: 80px; object-fit: cover;">
                                    }
                                    else
                                    {
                                        <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center text-white" style="width: 80px; height: 80px; font-size: 2rem;">
                                            <i class="bi bi-person"></i>
                                        </div>
                                    }
                                </div>
                                <div class="flex-grow-1">
                                    <h5 class="mb-1">@Model?.AdSoyad</h5>
                                    <p class="mb-0 text-muted">
                                        @if (Model?.Boy != null && Model?.Kilo != null)
                                        {
                                            <span>Boy: @Model.Boy cm | Kilo: @Model.Kilo kg</span>
                                        }
                                        else
                                        {
                                            <span>Profil bilgilerinizi tamamlayƒ±n</span>
                                        }
                                    </p>
                                </div>
                                <div>
                                    <a asp-controller="Account" asp-action="Profile" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-pencil"></i> Profili D√ºzenle
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form id="aiForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="boy" class="form-label"><i class="bi bi-arrows-vertical"></i> Boy (cm)</label>
                                <input type="number" class="form-control" id="boy" name="Boy" value="@Model?.Boy" required min="100" max="250">
                                <div class="form-text">100-250 cm arasƒ±</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="kilo" class="form-label"><i class="bi bi-speedometer2"></i> Kilo (kg)</label>
                                <input type="number" step="0.1" class="form-control" id="kilo" name="Kilo" value="@Model?.Kilo" required min="30" max="300">
                                <div class="form-text">30-300 kg arasƒ±</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cinsiyet" class="form-label"><i class="bi bi-gender-ambiguous"></i> Cinsiyet</label>
                                <select class="form-select" id="cinsiyet" name="Cinsiyet" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="Erkek" selected="@(Model?.Cinsiyet == "Erkek" ? "selected" : null)">Erkek</option>
                                    <option value="Kadƒ±n" selected="@(Model?.Cinsiyet == "Kadƒ±n" ? "selected" : null)">Kadƒ±n</option>
                                    <option value="Diƒüer" selected="@(Model?.Cinsiyet == "Diƒüer" ? "selected" : null)">Diƒüer</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="yas" class="form-label"><i class="bi bi-calendar"></i> Ya≈ü (Opsiyonel)</label>
                                <input type="number" class="form-control" id="yas" name="Yas" min="13" max="100">
                                <div class="form-text">Daha iyi √∂neriler i√ßin</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="hedef" class="form-label"><i class="bi bi-target"></i> Hedefiniz</label>
                                <select class="form-select" id="hedef" name="Hedef" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="Kilo Verme">üî• Kilo Verme</option>
                                    <option value="Kas Geli≈ütirme">üí™ Kas Geli≈ütirme</option>
                                    <option value="Zayƒ±flama">‚öñÔ∏è Zayƒ±flama</option>
                                    <option value="Esneklik">üßò Esneklik ve Yoga</option>
                                    <option value="Genel Saƒülƒ±k">‚ù§Ô∏è Genel Saƒülƒ±k ve Fitness</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="aktiviteSeviyesi" class="form-label"><i class="bi bi-activity"></i> Aktivite Seviyesi</label>
                                <select class="form-select" id="aktiviteSeviyesi" name="AktiviteSeviyesi">
                                    <option value="">Se√ßiniz (Opsiyonel)</option>
                                    <option value="Hareketsiz">Hareketsiz (Ofis i≈üi)</option>
                                    <option value="Az Aktif">Az Aktif (Haftada 1-3 g√ºn)</option>
                                    <option value="Orta Aktif">Orta Aktif (Haftada 3-5 g√ºn)</option>
                                    <option value="√áok Aktif">√áok Aktif (Haftada 6-7 g√ºn)</option>
                                    <option value="Sporcu">Profesyonel Sporcu</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="foto" class="form-label"><i class="bi bi-camera"></i> Fotoƒüraf Y√ºkle (Opsiyonel)</label>
                            <input type="file" class="form-control" id="foto" name="Foto" accept="image/*">
                            <div class="form-text">
                                Fotoƒürafƒ±nƒ±zƒ± y√ºkleyerek analizlerinizi kayƒ±t altƒ±na alabilirsiniz.
                                @if (string.IsNullOrEmpty(Model?.ProfilResmi))
                                {
                                    <strong class="text-warning">Not:</strong> <span>Profil resminizi <a asp-controller="Account" asp-action="Profile">profil sayfanƒ±zdan</a> g√ºncelleyebilirsiniz.</span>
                                }
                            </div>
                        </div>

                        <!-- Fotoƒüraf √ñnizleme -->
                        <div class="mb-3" id="photoPreview" style="display: none;">
                            <div class="card">
                                <div class="card-body text-center">
                                    <img id="previewImage" src="" alt="√ñnizleme" class="img-fluid rounded" style="max-height: 200px;">
                                    <button type="button" class="btn btn-sm btn-danger mt-2" onclick="removePhoto()">
                                        <i class="bi bi-trash"></i> Fotoƒürafƒ± Kaldƒ±r
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-success">
                            <i class="bi bi-robot"></i> <strong>G√∂m√ºl√º AI Modeli:</strong>
                            Bilimsel form√ºller ve kural tabanlƒ± yapay zeka ile ki≈üiye √∂zel detaylƒ± √∂neriler olu≈üturulur.
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-lg btn-primary" id="submitBtn">
                                <i class="bi bi-magic"></i> Plan Olu≈ütur
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    <!-- Bilgi Paneli -->
    <div class="col-md-4">
        <!-- Nasƒ±l √áalƒ±≈üƒ±r -->
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="bi bi-lightbulb"></i> Nasƒ±l √áalƒ±≈üƒ±r?</h5>
            </div>
            <div class="card-body">
                <p>G√∂m√ºl√º yapay zeka modelimiz, bilimsel form√ºller kullanarak ki≈üisel bilgilerinizi analiz eder ve size √∂zel programlar olu≈üturur.</p>
                <hr>
                <p><strong>Model √ñzellikleri:</strong></p>
                <ul class="small">
                    <li>‚úÖ BMI hesaplama ve analiz</li>
                    <li>‚úÖ Mifflin-St Jeor form√ºl√º ile kalori hesaplama</li>
                    <li>‚úÖ Ki≈üiye √∂zel egzersiz programƒ±</li>
                    <li>‚úÖ Makro besin hedefleri</li>
                    <li>‚úÖ Haftalƒ±k detaylƒ± plan</li>
                    <li>‚úÖ Motivasyon ve ipu√ßlarƒ±</li>
                </ul>
                <hr>
                <div class="alert alert-success small mb-0">
                    <i class="bi bi-check-circle"></i> <strong>Avantaj:</strong> Harici API gerekmez, anƒ±nda √ßalƒ±≈üƒ±r, √ºcretsizdir!
                </div>
            </div>
        </div>
    </div>
    </div>

    <!-- Sonu√ß Kartƒ± -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card shadow" id="resultCard" style="display: none;">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> Sizin ƒ∞√ßin √ñnerilen Program</h5>
                </div>
                <div class="card-body" id="resultContent">
                    <!-- AJAX ile doldurulacak -->
                </div>
            </div>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Fotoƒüraf √∂nizleme
            $('#foto').change(function() {
                var file = this.files[0];
                if (file) {
                    var reader = new FileReader();
                    reader.onload = function(e) {
                        $('#previewImage').attr('src', e.target.result);
                        $('#photoPreview').fadeIn();
                    }
                    reader.readAsDataURL(file);
                }
            });

            // Egzersiz √ñnerisi Formu
            $('#aiForm').submit(function (e) {
                e.preventDefault();

                var formData = new FormData(this);
                var submitBtn = $('#submitBtn');
                var originalText = submitBtn.html();

                submitBtn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Analiz ediliyor...');

                $.ajax({
                    url: '@Url.Action("GetEgzersizOnerisi", "AI")',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        submitBtn.prop('disabled', false).html(originalText);

                        if (response.success) {
                            $('#resultContent').html(response.oneriHTML);
                            $('#resultCard').fadeIn();
                            $('html, body').animate({
                                scrollTop: $("#resultCard").offset().top - 100
                            }, 500);
                        } else {
                            alert('Hata: ' + (response.message || 'Bilinmeyen hata'));
                        }
                    },
                    error: function (xhr, status, error) {
                        submitBtn.prop('disabled', false).html(originalText);
                        alert('Bir hata olu≈ütu: ' + error);
                    }
                });
            });

        });

        // Fotoƒüraf kaldƒ±rma
        function removePhoto() {
            $('#foto').val('');
            $('#photoPreview').fadeOut();
        }
    </script>
}
