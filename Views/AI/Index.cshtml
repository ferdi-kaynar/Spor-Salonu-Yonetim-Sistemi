@model FitnessSalonYonetim.Models.ApplicationUser

@{
    ViewData["Title"] = "AI Egzersiz & Diyet Asistanƒ±";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 class="mb-3"><i class="bi bi-robot"></i> Yapay Zeka Destekli Fitness Asistanƒ±</h1>
            <p class="lead text-muted">Ki≈üiye √∂zel egzersiz programlarƒ±, diyet √∂nerileri ve motivasyon g√∂rselleri olu≈üturun</p>
        </div>
    </div>

    <div class="row">
        <!-- Egzersiz & Diyet √ñnerisi B√∂l√ºm√º -->
        <div class="col-md-8">
            <div class="card shadow mb-4">
                <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <h5 class="mb-0 text-white"><i class="bi bi-person-check"></i> Ki≈üisel Fitness Planƒ± Olu≈ütur</h5>
                </div>
                <div class="card-body">
                    <form id="aiForm" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="boy" class="form-label"><i class="bi bi-arrows-vertical"></i> Boy (cm)</label>
                                <input type="number" class="form-control" id="boy" name="Boy" value="@Model?.Boy" required min="100" max="250">
                                <div class="form-text">100-250 cm arasƒ±</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="kilo" class="form-label"><i class="bi bi-speedometer2"></i> Kilo (kg)</label>
                                <input type="number" step="0.1" class="form-control" id="kilo" name="Kilo" value="@Model?.Kilo" required min="30" max="300">
                                <div class="form-text">30-300 kg arasƒ±</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="cinsiyet" class="form-label"><i class="bi bi-gender-ambiguous"></i> Cinsiyet</label>
                                <select class="form-select" id="cinsiyet" name="Cinsiyet" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="Erkek">Erkek</option>
                                    <option value="Kadƒ±n">Kadƒ±n</option>
                                    <option value="Diƒüer">Diƒüer</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="yas" class="form-label"><i class="bi bi-calendar"></i> Ya≈ü (Opsiyonel)</label>
                                <input type="number" class="form-control" id="yas" name="Yas" min="13" max="100">
                                <div class="form-text">Daha iyi √∂neriler i√ßin</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="hedef" class="form-label"><i class="bi bi-target"></i> Hedefiniz</label>
                                <select class="form-select" id="hedef" name="Hedef" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="Kilo Verme">üî• Kilo Verme</option>
                                    <option value="Kas Geli≈ütirme">üí™ Kas Geli≈ütirme</option>
                                    <option value="Zayƒ±flama">‚öñÔ∏è Zayƒ±flama</option>
                                    <option value="Esneklik">üßò Esneklik ve Yoga</option>
                                    <option value="Genel Saƒülƒ±k">‚ù§Ô∏è Genel Saƒülƒ±k ve Fitness</option>
                                </select>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="aktiviteSeviyesi" class="form-label"><i class="bi bi-activity"></i> Aktivite Seviyesi</label>
                                <select class="form-select" id="aktiviteSeviyesi" name="AktiviteSeviyesi">
                                    <option value="">Se√ßiniz (Opsiyonel)</option>
                                    <option value="Hareketsiz">Hareketsiz (Ofis i≈üi)</option>
                                    <option value="Az Aktif">Az Aktif (Haftada 1-3 g√ºn)</option>
                                    <option value="Orta Aktif">Orta Aktif (Haftada 3-5 g√ºn)</option>
                                    <option value="√áok Aktif">√áok Aktif (Haftada 6-7 g√ºn)</option>
                                    <option value="Sporcu">Profesyonel Sporcu</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="foto" class="form-label"><i class="bi bi-camera"></i> Fotoƒüraf Y√ºkle (Opsiyonel)</label>
                            <input type="file" class="form-control" id="foto" name="Foto" accept="image/*">
                            <div class="form-text">Fotoƒürafƒ±nƒ±zƒ± y√ºkleyerek daha ki≈üiselle≈ütirilmi≈ü √∂neriler alabilirsiniz</div>
                        </div>

                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> <strong>Yapay Zeka Desteƒüi:</strong>
                            OpenAI API yapƒ±landƒ±rƒ±ldƒ±ysa, GPT-4 ile ki≈üiye √∂zel detaylƒ± √∂neriler olu≈üturulur.
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-lg btn-primary" id="submitBtn">
                                <i class="bi bi-magic"></i> Plan Olu≈ütur
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Bilgi Paneli -->
        <div class="col-md-4">
            <!-- Nasƒ±l √áalƒ±≈üƒ±r -->
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-lightbulb"></i> Nasƒ±l √áalƒ±≈üƒ±r?</h5>
                </div>
                <div class="card-body">
                    <p>Yapay zeka destekli sistemimiz, ki≈üisel bilgilerinizi analiz ederek size √∂zel egzersiz programlarƒ± √∂nerir.</p>
                    <hr>
                    <p><strong>√ñzellikler:</strong></p>
                    <ul class="small">
                        <li>‚úÖ BMI hesaplama</li>
                        <li>‚úÖ GPT-4 ile detaylƒ± analizler</li>
                        <li>‚úÖ Ki≈üiye √∂zel egzersiz programƒ±</li>
                        <li>‚úÖ Beslenme tavsiyeleri</li>
                        <li>‚úÖ Hedef odaklƒ± planlar</li>
                        <li>‚úÖ Motivasyon g√∂rselleri</li>
                    </ul>
                </div>
            </div>

            <!-- Motivasyon G√∂rseli Olu≈ütur -->
            <div class="card shadow">
                <div class="card-header bg-gradient" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <h5 class="mb-0 text-white"><i class="bi bi-image"></i> Motivasyon G√∂rseli</h5>
                </div>
                <div class="card-body">
                    <form id="imageForm">
                        <div class="mb-3">
                            <label for="hedefVucutTipi" class="form-label">Hedef V√ºcut Tipi</label>
                            <select class="form-select" id="hedefVucutTipi" name="HedefVucutTipi" required>
                                <option value="">Se√ßiniz</option>
                                <option value="Kaslƒ±">üí™ Kaslƒ±</option>
                                <option value="Zayƒ±f">‚ö° Zayƒ±f ve Fit</option>
                                <option value="Fit">‚ù§Ô∏è Fit ve Saƒülƒ±klƒ±</option>
                                <option value="Atletik">üèÉ Atletik</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="imageCinsiyet" class="form-label">Cinsiyet</label>
                            <select class="form-select" id="imageCinsiyet" name="Cinsiyet" required>
                                <option value="">Se√ßiniz</option>
                                <option value="Erkek">Erkek</option>
                                <option value="Kadƒ±n">Kadƒ±n</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="egzersizTuru" class="form-label">Egzersiz T√ºr√º</label>
                            <select class="form-select" id="egzersizTuru" name="EgzersizTuru">
                                <option value="">Se√ßiniz (Opsiyonel)</option>
                                <option value="weightlifting">Aƒüƒ±rlƒ±k Kaldƒ±rma</option>
                                <option value="running">Ko≈üu</option>
                                <option value="yoga">Yoga</option>
                                <option value="crossfit">CrossFit</option>
                                <option value="swimming">Y√ºzme</option>
                            </select>
                        </div>

                        <div class="alert alert-warning small">
                            <i class="bi bi-exclamation-triangle"></i> DALL-E 3 API gerektirir
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary" id="imageBtn">
                                <i class="bi bi-stars"></i> G√∂rsel Olu≈ütur
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Sonu√ß Kartƒ± -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card shadow" id="resultCard" style="display: none;">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-clipboard-check"></i> Sizin ƒ∞√ßin √ñnerilen Program</h5>
                </div>
                <div class="card-body" id="resultContent">
                    <!-- AJAX ile doldurulacak -->
                </div>
            </div>
        </div>
    </div>

    <!-- G√∂rsel Sonu√ß Kartƒ± -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card shadow" id="imageResultCard" style="display: none;">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-image"></i> Motivasyon G√∂rseliniz</h5>
                </div>
                <div class="card-body text-center">
                    <img id="generatedImage" src="" alt="Motivasyon G√∂rseli" class="img-fluid rounded shadow" style="max-height: 500px;">
                    <div class="mt-3">
                        <a id="downloadImage" href="" download="motivasyon.png" class="btn btn-success">
                            <i class="bi bi-download"></i> ƒ∞ndir
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Egzersiz √ñnerisi Formu
            $('#aiForm').submit(function (e) {
                e.preventDefault();

                var formData = new FormData(this);
                var submitBtn = $('#submitBtn');
                var originalText = submitBtn.html();

                submitBtn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> Analiz ediliyor...');

                $.ajax({
                    url: '@Url.Action("GetEgzersizOnerisi", "AI")',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        submitBtn.prop('disabled', false).html(originalText);

                        if (response.success) {
                            $('#resultContent').html(response.oneriHTML);
                            $('#resultCard').fadeIn();
                            $('html, body').animate({
                                scrollTop: $("#resultCard").offset().top - 100
                            }, 500);
                        } else {
                            alert('Hata: ' + (response.message || 'Bilinmeyen hata'));
                        }
                    },
                    error: function (xhr, status, error) {
                        submitBtn.prop('disabled', false).html(originalText);
                        alert('Bir hata olu≈ütu: ' + error);
                    }
                });
            });

            // G√∂rsel Olu≈üturma Formu
            $('#imageForm').submit(function (e) {
                e.preventDefault();

                var formData = new FormData(this);
                var imageBtn = $('#imageBtn');
                var originalText = imageBtn.html();

                imageBtn.prop('disabled', true).html('<i class="bi bi-hourglass-split"></i> G√∂rsel olu≈üturuluyor...');

                $.ajax({
                    url: '@Url.Action("GenerateMotivationImage", "AI")',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        imageBtn.prop('disabled', false).html(originalText);

                        if (response.success && response.imageUrl) {
                            $('#generatedImage').attr('src', response.imageUrl);
                            $('#downloadImage').attr('href', response.imageUrl);
                            $('#imageResultCard').fadeIn();
                            $('html, body').animate({
                                scrollTop: $("#imageResultCard").offset().top - 100
                            }, 500);
                        } else {
                            alert('Hata: ' + (response.message || 'G√∂rsel olu≈üturulamadƒ±'));
                        }
                    },
                    error: function (xhr, status, error) {
                        imageBtn.prop('disabled', false).html(originalText);
                        alert('Bir hata olu≈ütu: ' + error);
                    }
                });
            });
        });
    </script>
}
